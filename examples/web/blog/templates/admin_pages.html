{% extends "base.html" %}

{% block title %}Manage Pages - Admin{% endblock %}

{% block content %}
<article>
  <header>
    <h1>Manage Pages</h1>
    <p><a href="/admin" role="button" class="secondary">Back to Posts</a> <a href="/admin/pages/new" role="button" class="contrast">New Page</a></p>
  </header>

  {% if pages | length == 0 %}
  <p>No pages yet. <a href="/admin/pages/new">Create your first page</a>.</p>
  {% else %}
  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Slug</th>
        <th>Order</th>
        <th>Updated</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for page in pages %}
      <tr>
        <td><a href="/page/{{ page.slug }}">{{ page.title }}</a></td>
        <td><code>{{ page.slug }}</code></td>
        <td>{{ page.sort_order }}</td>
        <td>{{ page.updated_at }}</td>
        <td>
          <a href="/admin/pages/edit/{{ page.slug }}" role="button" class="secondary outline" style="margin-right: 0.5rem;">Edit</a>
          <button onclick="deletePage('{{ page.slug }}')" class="secondary outline">Delete</button>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</article>

<script>
  async function deletePage(slug) {
    if (!confirm('Are you sure you want to delete this page?')) {
      return;
    }

    try {
      const response = await fetch('/admin/pages/delete/' + slug, {
        method: 'POST'
      });

      if (response.ok) {
        window.location.reload();
      } else {
        alert('Failed to delete page');
      }
    } catch (error) {
      alert('Error deleting page: ' + error.message);
    }
  }
</script>
{% endblock %}
